<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ЕГЭ химия — Номенклатура неорганики</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  margin: 20px;
  line-height: 1.4;
}

a { color: inherit; }

.topbar {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  margin-bottom: 14px;
}

.pill {
  border: 1px solid #e5e5e5;
  border-radius: 999px;
  padding: 6px 10px;
  user-select: none;
}

.card {
  border: 1px solid #e5e5e5;
  border-radius: 12px;
  padding: 14px;
  max-width: 1000px;
}

.row {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  align-items: center;
}

.muted { color: #666; }
.small { font-size: 13px; }

.answers {
  display: grid;
  grid-template-columns: 1fr;
  gap: 10px;
  margin-top: 12px;
}
@media (min-width: 700px) {
  .answers { grid-template-columns: 1fr 1fr; }
}

.btn {
  text-align: left;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid #ccc;
  background: #f7f7f7;
  cursor: pointer;
  font-size: 16px;
}
.btn:hover { background: #f0f0f0; }

.btn.selected {
  border-color: #2563eb;
  background: #eff6ff;
}

.btn.correct {
  border-color: #16a34a;
  background: #f0fdf4;
}

.btn.wrong {
  border-color: #dc2626;
  background: #fef2f2;
}

.primary {
  padding: 10px 14px;
  border-radius: 10px;
  border: none;
  background: #111;
  color: #fff;
  cursor: pointer;
}
.primary:disabled {
  opacity: 0.5;
  cursor: default;
}

.ok { color: #16a34a; font-weight: 600; }
.bad { color: #dc2626; font-weight: 600; }

textarea {
  width: 100%;
  min-height: 180px;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid #ccc;
  font-family: ui-monospace, monospace;
}
</style>
</head>

<body>

<div class="topbar">
  <a href="index.html">← На главную</a>
  <span class="pill">Номенклатура неорганики</span>
  <span class="pill">Выбор → Ответить → Далее</span>
</div>

<div class="card">

<h1>Тренажёр</h1>
<p class="muted">Выберите вариант, затем нажмите «Ответить». Пока не нажали — ответ можно менять.</p>

<div class="row">
  <span class="pill">Вопрос: <span id="qIndex">1</span>/<span id="qTotal">0</span></span>
  <span class="pill">Верно: <span id="okCount">0</span></span>
  <span class="pill">Ошибок: <span id="badCount">0</span></span>
  <span class="pill">Точность: <span id="score">0</span>%</span>
</div>

<h2 id="question">—</h2>
<p class="muted small" id="tip">Подсказка появится после проверки.</p>

<div class="answers" id="answers"></div>

<div class="row" style="margin-top:12px;">
  <button id="actionBtn" class="primary" disabled>Ответить</button>
  <span class="muted small" id="status">Выберите вариант ответа</span>
</div>

<div id="feedback" style="margin-top:10px;"></div>

<hr>

<div class="row">
  <label class="pill">
    <input type="checkbox" id="autoCorrect">
    Автопереход, если ответ правильный
  </label>

  <label class="pill">
    <input type="checkbox" id="autoWrong">
    Автопереход, если ответ неправильный
  </label>
</div>

<hr>

<div class="row">
  <button onclick="restart()">Сначала</button>
  <button onclick="repeatWrong()">Повторить ошибки</button>
  <button onclick="downloadCSV()">Скачать CSV</button>
</div>

<textarea id="log" readonly></textarea>

</div>

<script>
const TASKS = [
  { f:"NaCl", right:"хлорид натрия", tip:"Средняя соль" },
  { f:"K2SO4", right:"сульфат калия", tip:"Соль серной кислоты" },
  { f:"Na2CO3", right:"карбонат натрия", tip:"Кальцинированная сода" },
  { f:"NaHCO3", right:"гидрокарбонат натрия", tip:"Кислая соль" },
  { f:"CaCO3", right:"карбонат кальция", tip:"Известняк" },
  { f:"H2SO4", right:"серная кислота", tip:"Сильная двухосновная" },
  { f:"HNO3", right:"азотная кислота", tip:"Сильная одноосновная" },
  { f:"NaOH", right:"гидроксид натрия", tip:"Щёлочь" },
  { f:"Al(OH)3", right:"гидроксид алюминия", tip:"Амфотерный" },
  { f:"Fe2O3", right:"оксид железа(iii)", tip:"Fe³⁺" }
];

function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}
function norm(s){ return s.toLowerCase().replace(/ё/g,"е").trim(); }

let items = shuffle([...TASKS]);
let idx = 0, ok = 0, bad = 0;
let selected = null;
let phase = "choose";
let wrongPool = [];
let results = [];

const qIndex = document.getElementById("qIndex");
const qTotal = document.getElementById("qTotal");
const okCount = document.getElementById("okCount");
const badCount = document.getElementById("badCount");
const score = document.getElementById("score");
const question = document.getElementById("question");
const tip = document.getElementById("tip");
const answers = document.getElementById("answers");
const actionBtn = document.getElementById("actionBtn");
const status = document.getElementById("status");
const feedback = document.getElementById("feedback");
const log = document.getElementById("log");
const autoCorrect = document.getElementById("autoCorrect");
const autoWrong = document.getElementById("autoWrong");

function render(){
  qTotal.textContent = items.length;
  qIndex.textContent = idx+1;
  okCount.textContent = ok;
  badCount.textContent = bad;
  score.textContent = ok+bad ? Math.round(ok/(ok+bad)*100) : 0;

  answers.innerHTML = "";
  feedback.innerHTML = "";
  selected = null;
  phase = "choose";
  actionBtn.textContent = "Ответить";
  actionBtn.disabled = true;
  status.textContent = "Выберите вариант ответа";
  tip.textContent = "Подсказка появится после проверки.";

  if(idx >= items.length){
    question.textContent = "Тест завершён";
    return;
  }

  const cur = items[idx];
  question.textContent = "Выберите название: " + cur.f;

  let opts = shuffle([
    cur.right,
    ...shuffle(TASKS.map(t=>t.right).filter(x=>x!==cur.right)).slice(0,3)
  ]);

  for(const o of opts){
    const b = document.createElement("button");
    b.className = "btn";
    b.textContent = o;
    b.onclick = () => select(o, b);
    answers.appendChild(b);
  }
}

function select(val, btn){
  if(phase!=="choose") return;
  selected = val;
  [...answers.children].forEach(b=>b.classList.remove("selected"));
  btn.classList.add("selected");
  actionBtn.disabled = false;
  status.textContent = "Нажмите «Ответить»";
}

actionBtn.onclick = () => {
  if(phase==="choose") submit();
  else next();
};

function submit(){
  const cur = items[idx];
  const correct = norm(selected) === norm(cur.right);
  phase = "checked";
  actionBtn.textContent = "Далее";

  [...answers.children].forEach(b=>{
    b.disabled = true;
    if(norm(b.textContent)===norm(cur.right)) b.classList.add("correct");
    if(norm(b.textContent)===norm(selected) && !correct) b.classList.add("wrong");
  });

  if(correct){
    ok++;
    feedback.innerHTML = "<div class='ok'>Верно</div>";
  } else {
    bad++;
    wrongPool.push(cur);
    feedback.innerHTML = "<div class='bad'>Неверно. Правильно: "+cur.right+"</div>";
  }

  tip.textContent = cur.tip;
  results.push(`${cur.f};${selected};${cur.right};${correct?1:0}`);
  updateLog();

  if((correct && autoCorrect.checked) || (!correct && autoWrong.checked)){
    actionBtn.disabled = true;
    setTimeout(next, 700);
  }
}

function next(){
  idx++;
  render();
}

function restart(){
  items = shuffle([...TASKS]);
  idx=ok=bad=0;
  wrongPool=[];
  results=[];
  updateLog();
  render();
}

function repeatWrong(){
  if(!wrongPool.length) return;
  items = shuffle([...wrongPool]);
  idx=ok=bad=0;
  results=[];
  updateLog();
  render();
}

function updateLog(){
  log.value = "Формула;Выбор;Правильный ответ;Верно\n" + results.join("\n");
}

function downloadCSV(){
  const blob = new Blob([log.value],{type:"text/csv;charset=utf-8"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "nomenclature.csv";
  a.click();
}
render();
</script>

</body>
</html>
